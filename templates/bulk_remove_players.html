<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bulk Remove Players</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .removal-option {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #f8f9fa;
        }
        .removal-option.active {
            border-color: #0d6efd;
            background-color: #e7f3ff;
        }
        .player-checkbox {
            margin: 5px 0;
        }
        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        #player_selection {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        .player-checkbox label {
            cursor: pointer;
            padding: 5px;
            border-radius: 3px;
            transition: background-color 0.2s;
        }
        .player-checkbox label:hover {
            background-color: #e9ecef;
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <div class="row">
            <div class="col-md-12">
                <h2 class="mb-4">üóëÔ∏è Bulk Remove Players</h2>
                
                <!-- Match Info -->
                {% if teams %}
                <div class="stats-card">
                    <h4>Match: {{ teams[0]['team1'] }} vs {{ teams[0]['team2'] }}</h4>
                    <p class="mb-0">Total Players: {{ players|length }}</p>
                    {% if players|length == 0 %}
                    <p class="mb-0 text-warning">‚ö†Ô∏è No players found for this match!</p>
                    {% endif %}
                </div>
                {% endif %}
                


                <form method="POST" action="/bulkRemovePlayers" id="bulkRemoveForm">
                    <input type="hidden" name="matchid" value="{{ matchid }}">
                    
                    <!-- Removal Options -->
                    <div class="row">
                        <div class="col-md-6">
                            <!-- Remove Selected Players -->
                            <div class="removal-option" data-type="selected_players">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="removal_type" value="selected_players" id="selected_players">
                                    <label class="form-check-label" for="selected_players">
                                        <h5>üìã Remove Selected Players</h5>
                                    </label>
                                </div>
                                <div class="mt-3" id="player_selection" style="display: none;">
                                    {% if players %}
                                    <div class="row">
                                        {% for player in players %}
                                        <div class="col-md-6">
                                            <div class="form-check player-checkbox">
                                                <input class="form-check-input" type="checkbox" name="selected_players" value="{{ player.playername }}" id="player_{{ loop.index }}">
                                                <label class="form-check-label" for="player_{{ loop.index }}">
                                                    {{ player.playername }} ({{ player.teamname }} - {{ player.role }})
                                                </label>
                                            </div>
                                        </div>
                                        {% endfor %}
                                    </div>
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAll()">Select All</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="selectNone()">Select None</button>
                                    </div>
                                    {% else %}
                                    <div class="alert alert-warning">
                                        No players found for this match.
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Remove by Role -->
                            <div class="removal-option" data-type="by_role">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="removal_type" value="by_role" id="by_role">
                                    <label class="form-check-label" for="by_role">
                                        <h5>üèè Remove by Role</h5>
                                    </label>
                                </div>
                                <div class="mt-3" id="role_selection" style="display: none;">
                                    <select class="form-select" name="role_filter">
                                        <option value="">Select Role</option>
                                        {% for role in unique_roles %}
                                        <option value="{{ role }}">{{ role }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>

                            <!-- Remove by Team -->
                            <div class="removal-option" data-type="by_team">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="removal_type" value="by_team" id="by_team">
                                    <label class="form-check-label" for="by_team">
                                        <h5>üèÜ Remove by Team</h5>
                                    </label>
                                </div>
                                <div class="mt-3" id="team_selection" style="display: none;">
                                    <select class="form-select" name="team_filter">
                                        <option value="">Select Team</option>
                                        {% for team in unique_teams %}
                                        <option value="{{ team }}">{{ team }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <!-- Remove by Percentage -->
                            <div class="removal-option" data-type="by_percentage">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="removal_type" value="by_percentage" id="by_percentage">
                                    <label class="form-check-label" for="by_percentage">
                                        <h5>üìä Remove by Selection %</h5>
                                    </label>
                                </div>
                                <div class="mt-3" id="percentage_selection" style="display: none;">
                                    <div class="row">
                                        <div class="col-6">
                                            <label class="form-label">Min %</label>
                                            <input type="number" class="form-control" name="min_percentage" min="0" max="100" step="0.1">
                                        </div>
                                        <div class="col-6">
                                            <label class="form-label">Max %</label>
                                            <input type="number" class="form-control" name="max_percentage" min="0" max="100" step="0.1">
                                        </div>
                                    </div>
                                    <small class="text-muted">Remove players with selection percentage between these values</small>
                                </div>
                            </div>

                            <!-- Remove All Players -->
                            <div class="removal-option" data-type="all_players">
                                <div class="form-check">
                                    <input class="form-check-input" type="radio" name="removal_type" value="all_players" id="all_players">
                                    <label class="form-check-label" for="all_players">
                                        <h5>üö® Remove ALL Players</h5>
                                    </label>
                                </div>
                                <div class="mt-3" id="all_players_warning" style="display: none;">
                                    <div class="alert alert-danger">
                                        <strong>‚ö†Ô∏è Warning:</strong> This will remove ALL players from this match!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Action Buttons -->
                    <div class="d-flex justify-content-between mt-4">
                        <form method="POST" action="/matchpage" class="d-inline">
                            <input type="hidden" name="matchid" value="{{ matchid }}">
                            <button type="submit" class="btn btn-secondary">
                                ‚Üê Back to Match
                            </button>
                        </form>
                        <button type="submit" class="btn btn-danger" id="removeBtn" disabled>
                            üóëÔ∏è Remove Players
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Handle radio button changes
        document.querySelectorAll('input[name="removal_type"]').forEach(radio => {
            radio.addEventListener('change', function() {
                // Hide all option details
                document.querySelectorAll('[id$="_selection"], [id$="_warning"]').forEach(el => {
                    el.style.display = 'none';
                });
                
                // Remove active class from all options
                document.querySelectorAll('.removal-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                
                // Show selected option details based on the selected type
                const selectedType = this.value;
                let targetDiv = null;
                
                if (selectedType === 'selected_players') {
                    targetDiv = document.getElementById('player_selection');
                } else if (selectedType === 'by_role') {
                    targetDiv = document.getElementById('role_selection');
                } else if (selectedType === 'by_team') {
                    targetDiv = document.getElementById('team_selection');
                } else if (selectedType === 'by_percentage') {
                    targetDiv = document.getElementById('percentage_selection');
                } else if (selectedType === 'all_players') {
                    targetDiv = document.getElementById('all_players_warning');
                }
                
                if (targetDiv) {
                    targetDiv.style.display = 'block';
                }
                
                // Add active class to selected option
                this.closest('.removal-option').classList.add('active');
                
                // Enable remove button
                document.getElementById('removeBtn').disabled = false;
            });
        });

        function selectAll() {
            const checkboxes = document.querySelectorAll('input[name="selected_players"]');
            checkboxes.forEach(cb => {
                cb.checked = true;
            });
        }

        function selectNone() {
            const checkboxes = document.querySelectorAll('input[name="selected_players"]');
            checkboxes.forEach(cb => {
                cb.checked = false;
            });
        }

        // Form validation
        document.getElementById('bulkRemoveForm').addEventListener('submit', function(e) {
            const removalType = document.querySelector('input[name="removal_type"]:checked');
            
            if (!removalType) {
                e.preventDefault();
                alert('Please select a removal option');
                return;
            }

            if (removalType.value === 'all_players') {
                if (!confirm('Are you sure you want to remove ALL players from this match? This action cannot be undone.')) {
                    e.preventDefault();
                    return;
                }
            }

            if (removalType.value === 'selected_players') {
                const selectedPlayers = document.querySelectorAll('input[name="selected_players"]:checked');
                if (selectedPlayers.length === 0) {
                    e.preventDefault();
                    alert('Please select at least one player to remove');
                    return;
                }
            }
        });
    </script>
</body>
</html>